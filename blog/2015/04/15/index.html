
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Java中日期时间API小结 - 楚云之南</title>
  <meta name="author" content="楚云">

  
  <meta name="description" content="Java中为处理日期和时间提供了大量的API，确实有把一件简单的事情搞复杂的嫌疑，各种类：Date Time Timestamp Calendar...，但是如果能够看到时间处理的本质就可以轻松hold住这堆东西了。 常用的类 表示类 java.util.Date : &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://chuyun923.github.io/blog/2015/04/15">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="楚云之南" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">楚云之南</a></h1>
  
    <h2>先解决问题再写代码</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="https://www.google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:chuyun923.github.io" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Java中日期时间API小结</h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-04-15T17:47:06+08:00'><span class='date'><span class='date-month'>Apr</span> <span class='date-day'>15</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>5:47 pm</span></time>
        
      </p>
    
  </header>


<div class="entry-content"><p>Java中为处理日期和时间提供了大量的API，确实有把一件简单的事情搞复杂的嫌疑，各种类：<code>Date Time Timestamp Calendar...</code>，但是如果能够看到时间处理的本质就可以轻松hold住这堆东西了。</p>

<!--more-->


<h2>常用的类</h2>

<h3>表示类</h3>

<ul>
<li><code>java.util.Date</code> :能够准确记录到毫秒级别的时间表示类，但是其中的各种get set(修改时间或者获取时间中某一个特殊参数)都已经被废弃。</li>
<li><code>java.sql.Date</code> :为数据库提供的日期类，继承自<code>util</code>包中的<code>Date</code>，但是这个类只能够操作日期，不能读取或者修改时间。<strong>sql和util中Date内部进行存储的long，都可以保存到毫秒级别</strong></li>
<li><code>java.sql.Time</code> :为数据库提供的时间类，和<code>Date</code>相反，它只能获取和操作时间相关的信息。</li>
<li><code>java.sql.Timestamp</code>:时间戳，继承<code>util.Date</code>，它不仅能够完美支持<code>util.Date</code>的功能，而且可以支持到纳秒级别(10^-9 s)。</li>
</ul>


<h3>工具类</h3>

<ul>
<li><code>Calendar</code>:主要用来操作一个<code>Date</code>类型，提供了一系列接口来获取或修改其中的信息。</li>
<li><code>TimeZone</code>:用来配合<code>Calendar</code> 操作<code>Date</code>，主要是考虑时区的问题，值得注意的是，在<code>Date</code>中存储的信息是一个<strong>绝对标准时间(稍后说明)</strong>，而如果需要进行时区的转化，那么只需要配合此类即可。</li>
<li><code>SimpleDateFormat</code>:常用的格式化<code>Date</code>的工具，主要是进行<code>String</code>和日期之间的互换。</li>
</ul>


<h2>基本概念</h2>

<h3>时间的来源</h3>

<p>注意，这里并不是讨论一个哲学的问题，在大部分的编程语言中，我们都是采用从1970-01-01 00:00:00.000 开始至今的毫秒差作为表示时间的数值，<strong>这个时间是绝对公立的，它和时区没有任何关系</strong>。在Java中任何时间的表示类的底层存储的毫秒数都是一个这样的标准时间。</p>

<p>在java中获取当前时间接口是<code>System.currentTimeMillis()</code>。</p>

<p>值得一提的是Java还提供了一个更加精确的时间：<code>System.nanoTime()</code>，获取一个时间精确到纳秒，但是它并不是一个当前的精确时间，而是JVM提供的一个时间，它的主要用途是来精确衡量两个时间段之间的时间，如计算一段代码的执行时间：</p>

<pre><code>    long startTime = System.nanoTime();
   // ... the code being measured ...
   long estimatedTime = System.nanoTime() - startTime;
</code></pre>

<p>可以比较两个接口返回的内容：
    <code>System.currentTimeMillis()</code>:1429108246639
    <code>System.nanoTime()</code>:1429108246640(ms)089000&mdash;&mdash;->多了6位</p>

<h3>UTC和GMT</h3>

<p>这两个标准唯一不同之处在于UTC是基于GMT进行微调之后的一个时间，本文不去深究这两者的差别，在此认为这两者是一个东西。</p>

<p>初中地理教过我们，地球是24个时区，东部和西部各12个，时区的基准点是伦敦(基准UTC)，往东，会领先UTC，往西，会落后UTC。</p>

<p>如北京属于东八区，那么我们的时间会领先基准，也就是我们在早上9点时，伦敦是早上1点。如果我们在不同时区接发邮件的时候，可以发现这个问题。</p>

<p>这个时间是我收到一份来自华盛顿的邮件的时间：</p>

<p>2014年1月23日(星期四) 晚上7:29 (UTC-05:00 华盛顿、多伦多、古巴、智利时间)</p>

<p>这里我们可以在邮件时间后面发现<code>UTC-05:00</code>，说明这里是落后UTC基准5个小时。注意，前面的时间是发件人的本地时间，如果转化成北京所在时区的时间应该是加上13h，那我收到这封邮件的本地时间是：2014-01-24 星期五早上8:29。</p>

<h3>再谈TimeStamp</h3>

<p>前面说了，TimeStamp能够精确到纳秒，那它是怎么做到的呢？由于TimeStamp继承自<code>Date</code>，它把整数秒存储在超类中，而在子类中专门用一个long类型存储零的秒数:<code>nanos</code></p>

<p>需要注意，除非你显示去调用TimeStamp的这个构造器:
<code>public Timestamp(int year, int month, int date,
                     int hour, int minute, int second, int nano)</code></p>

<p>显示去指定nano的值，否则这个构造器的参数
<code>public Timestamp(long time)</code></p>

<p>的单位实际上是毫秒。</p>

<h2>API的使用</h2>

<p>最后再来说说日期时间的操作接口，过程基本如下图：</p>

<pre><code>           SimpleDateFormat &lt;------&gt;  Date   &lt;---------&gt; Calendar
</code></pre>

<p>Date负责存储一个绝对时间，并对两边提供操作接口。Calendar负责对Date中特定信息，比如这个时间是改年的第几个星期，此外，还可以通过set,add,roll接口来进行日期时间的增减。SimpleDateFormat主要作为一些格式化的输入输出。</p>

<h3>SimpleDateFormat</h3>

<p><code>SimpleDateFormat</code>的构造器接受一个String pattern，其中的pattern是预定义的：</p>

<pre><code>G 年代标志符
y 年
M 月
d 日
h 时 在上午或下午 (1~12)
H 时 在一天中 (0~23)
m 分
s 秒
S 毫秒
E 星期
D 一年中的第几天
F 一月中第几个星期几
w 一年中第几个星期
W 一月中第几个星期
a 上午 / 下午 标记符 
k 时 在一天中 (1~24)
K 时 在上午或下午 (0~11)
z 时区
</code></pre>

<p>例子1：</p>

<pre><code> SimpleDateFormat DATETIME_FORMATER_WITHWEEK = new SimpleDateFormat(
            "yyyy-MM-dd E HH:mm");

    java.util.Date date = new java.util.Date();
    System.out.println(DATETIME_FORMATER_WITHWEEK.format(date));

    //output: 2015-04-15 星期三 23:59 
    //当然，反过来，我也可以使用这个format将output的字符串转化成Date
</code></pre>

<h3>Calendar</h3>

<p>Calendar中主要需要了解的各种操作域，感觉这也是Java在做这个API时的一个败笔，灵活有余，可控性不足，初学者如果乱用域，将会产生各种bug。至于每一个域对应的时间分量，请自行google。</p>

<p>一些常用的filed：</p>

<ul>
<li>YEAR:年</li>
<li>MONTH：月（从0 开始，0 表示1月&hellip;.11表示12月）</li>
<li>DAY_OF_MONTH :几号（等同DATE）</li>
<li>DAY_OF_WEEK：星期几</li>
<li>DAY_OF_YEAR：年里面的天</li>
<li>DATE:几号（等同DAY_OF_MONTH）</li>
</ul>


<p>一个filed通常来说对应了日期时间中的某一个分量，在操作这个分类有些操作会向高位进位，而有的操作则不会【<strong>bug高发区域</strong>】。</p>

<p>例子2：</p>

<pre><code>SimpleDateFormat DATETIME_FORMATER_WITHWEEK = new SimpleDateFormat(
     "yyyy-MM-dd E");
    Calendar calendarT = Calendar.getInstance(Locale.CHINA);
    System.out.println(DATETIME_FORMATER_WITHWEEK.format(calendarT.getTime()));
    calendarT.set(Calendar.MONTH,12);// 月份进位
    System.out.println(DATETIME_FORMATER_WITHWEEK.format(calendarT.getTime()));
    //output:   2015-04-16 星期四
                    2016-01-16 星期六
</code></pre>

<p>例子3：</p>

<pre><code>        SimpleDateFormat DATETIME_FORMATER_WITHWEEK = new SimpleDateFormat(
     "yyyy-MM-dd E");
    Calendar calendarT = Calendar.getInstance(Locale.CHINA);
    System.out.println("原始    :"+DATETIME_FORMATER_WITHWEEK.format(calendarT.getTime()));
    calendarT.set(Calendar.DAY_OF_MONTH,1);// 当月第一天
    System.out.println("当月第一天:"+DATETIME_FORMATER_WITHWEEK.format(calendarT.getTime()));
    //roll不会进位
    calendarT.roll(Calendar.DATE,-1);
    System.out.println("roll -1:"+DATETIME_FORMATER_WITHWEEK.format(calendarT.getTime()));
    calendarT.set(Calendar.DAY_OF_MONTH,1);// 当月第一天
    calendarT.add(Calendar.DATE,-1);
    //add产生进位
    System.out.println("add -1:"+DATETIME_FORMATER_WITHWEEK.format(calendarT.getTime()));

    //output:原始    :2015-04-16 星期四
                当月第一天:2015-04-01 星期三
                roll -1:2015-04-30 星期四
                add -1:2015-03-31 星期二
</code></pre>

<p>最后还是需要说明一点，获取当前时间指的是当前本地时间对应的UTC时间，和时区没有关系！有点绕，没关系看代码：</p>

<p>例子4：</p>

<pre><code>Calendar calendar1 = Calendar.getInstance(Locale.CHINA);
    Calendar calendar2 = Calendar.getInstance(Locale.GERMAN);
    System.out.println(calendar1.getTimeInMillis());
    System.out.println(calendar2.getTimeInMillis());

    //output:
        1429115150117
        1429115150117
</code></pre>

<p>最后贴一个日期处理开源库：<a href="https://github.com/JodaOrg/joda-time"><strong>joda-time</strong></a></p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">楚云</span></span>

      




<time class='entry-date' datetime='2015-04-15T17:47:06+08:00'><span class='date'><span class='date-month'>Apr</span> <span class='date-day'>15</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>5:47 pm</span></time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/java/'>java</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="//twitter.com/share" class="twitter-share-button" data-url="http://chuyun923.github.io/blog/2015/04/15/" data-via="" data-counturl="http://chuyun923.github.io/blog/2015/04/15/" >Tweet</a>
  
  
  
  
  <!-- JiaThis Button BEGIN -->
<div class="jiathis_style_32x32">
	<a class="jiathis_button_qzone"></a>
	<a class="jiathis_button_tsina"></a>
	<a class="jiathis_button_tqq"></a>
	<a class="jiathis_button_weixin"></a>
	<a class="jiathis_button_renren"></a>
	<a href="http://www.jiathis.com/share" class="jiathis jiathis_txt jtico jtico_jiathis" target="_blank"></a>
	<a class="jiathis_counter_style"></a>
</div>
<script type="text/javascript" src="http://v3.jiathis.com/code/jia.js" charset="utf-8"></script>
<!-- JiaThis Button END -->
<!-- UY BEGIN -->
<div id="uyan_frame"></div>
<script type="text/javascript" src="http://v2.uyan.cc/code/uyan.js?uid=1987763"></script>
<!-- UY END -->
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2015/01/10/gsonyuan-ma-zhi-streamchu-li/" title="Previous Post: Gson源码(二)之JsonReader和JsonWriter">&laquo; Gson源码(二)之JsonReader和JsonWriter</a>
      
      
        <a class="basic-alignment right" href="/blog/2015/04/16/android-provider/" title="Next Post: Android Content Provider">Android Content Provider &raquo;</a>
      
    </p>
  </footer>
</article>

</div>

<aside class="sidebar">
  
    <section>
  <h1>最近发表</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2015/07/28/viewshi-jian-zhi-fu-viewhe-zi-viewzhi-jian-de-na-dian-shi/">View事件传递之父View和子View之间的那点事</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/07/15/recyclerviewde-keng/">Recyclerviewde Keng</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/07/13/android-viezhuang-tai-bao-cun/">Android 视图树状态保存</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/04/16/android-provider/">Android Content Provider</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/04/15/">Java中日期时间API小结</a>
      </li>
    
  </ul>
</section>




<section>
    <h1>文章分类</h1>
    <ul id="categories">
        <li class='category'><a href='/blog/categories/android/'>android (9)</a></li>
<li class='category'><a href='/blog/categories/java/'>java (3)</a></li>
<li class='category'><a href='/blog/categories/网络协议-http/'>网络协议/http (1)</a></li>
<li class='category'><a href='/blog/categories/闲记/'>闲记 (1)</a></li>

    </ul>
</section>
  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2015 - 楚云 -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
